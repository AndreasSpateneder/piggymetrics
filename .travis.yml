sudo: required
services:
- docker
language: java
jdk: oraclejdk8
dist: trusty
env:
  global:
  - COMMIT=${TRAVIS_COMMIT::7}
  - secure: fL8TPQAymLrc2bieXs5w5nEQh3vbdlaMPOwifauLv244yV/SVG8NIxJHGamG7wHomDIvoMqJcqSEOdZPem4er3VUNNbRCh954GUHcO07AwLktJVfwHAX9pRlJtQznXXh8xwJDKdQSRjjclIYXmslvdOQ+STm/CYIORlEALRWgFR5SpG+zNIXv3JeZiBCoe/4JoFeKC7NRntA+dJXYo7fthUzSD4UTrfJYCIwvMyl1Omb4U+HRY1k1SUOOQQ67KOLqOhBM6Fu20v7SIzjqoJwRl19zK0+YNfdlbbeytiAxrSgNFEi4rf71Rgx8+sGnrb/AS/LkHTtTuY1MbVrz2l+ffvJPouilSgKzNfV+4n8ljn3nHmN7vuQipBzBZKhZCygmF0S1Rjk+BQ8loap+J2sReDPOuKC+YF14NTTEn1KQYycG13PNaLJjgVlT/UjWrNfIzh1zVO4YX13b3B2QNhsCUZhLM2QIVa3IQ/IfIol404fL3dJnGcQtCNCmwHtv9dKTwu62xGaVkSJY3yu3SdmSELPcxh/0VDSDbD7CkmwlEYi9tnwsvRChE1UN4jr2daAzC8nC2gnr1dEnCctjT3uv1uupQG1d751KQ8aKZeoTVdwu1lsnTtRnT2J6oE3EBORS4KYRoyBLAW5moOsOXz7eoFTnm9ewgwY4OtAnHRZY8I=
  - secure: t1ZdXxPszaIPH95rulCDLlLm+L2x0t4Zv7nyCMrlxsvhUdWjmpRkr4WkmLLX9T9bvxstZfUevasXaxVjRD/sl4f1+usFqqtJqHXtt1TG9huJq3lIXNmCywX0WfVdzLyXSiubDFT2o4mrk4VTJch+BJNIsOSsd0aC9m7LOhMtWvvkleucXjdxNbWkEKRfwJXdTdttrGhiqh63I4cHbhTv7deC/TbtiI3m1I7gtbRjV/y72ywm/OaxZl5YRxxsqdSQ+B/TtId5nc7eaPL5IZWXpRI3gjWuOkDH4ooRkFGJ5ivgQOr6eqHFtc0h6SYMOZfj3sEryKbr0f1HG25qTIGTPugBInqqZz9XT/cew4GG8RmjGhbl6F+k8Q90XyYIKGVUXoe5HyJnX6iTzuQ4ftTbAG0Z6Cyrn9LuJdnQBZZRiFisHRsY6uYSx6dlYAaWa4TUANs/FJTArAlJLqrHOkdfRxXlneoYgUz9VxeMrZOASeWC3aTKyNei76pZTEupuLg764AN3fcnD1X5tNcYKcU/mm6VcV8sro8Mc5KHU2NkXv1gO9/6InmYVfS13AzXVUILqO3uWCa/3Uqz2cE0vunGphLOv3cjvpNGG8OfVlKHBMX7YhQ5ngebiK5uO+HNxIB6BCSMioZyDU7oOdf7ngAnWiWoGvyNmczFXnU+c+JjBJE=
after_success:
- bash <(curl -s https://codecov.io/bash)
- docker login -u $DOCKER_USER -p $DOCKER_PASS docker.io
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH
  ; fi`
- export CONFIG=amnonxx/piggymetrics-config
- docker build -t $CONFIG:$COMMIT ./config
- docker tag $CONFIG:$COMMIT $CONFIG:$TAG
- docker push $CONFIG
- export REGISTRY=amnonxx/piggymetrics-registry
- docker build -t $REGISTRY:$COMMIT ./registry
- docker tag $REGISTRY:$COMMIT $REGISTRY:$TAG
- docker push $REGISTRY
- export GATEWAY=amnonxx/piggymetrics-gateway
- docker build -t $GATEWAY:$COMMIT ./gateway
- docker tag $GATEWAY:$COMMIT $GATEWAY:$TAG
- docker push $GATEWAY
- export AUTH_SERVICE=amnonxx/piggymetrics-auth-service
- docker build -t $AUTH_SERVICE:$COMMIT ./auth-service
- docker tag $AUTH_SERVICE:$COMMIT $AUTH_SERVICE:$TAG
- docker push $AUTH_SERVICE
- export ACCOUNT_SERVICE=amnonxx/piggymetrics-account-service
- docker build -t $ACCOUNT_SERVICE:$COMMIT ./account-service
- docker tag $ACCOUNT_SERVICE:$COMMIT $ACCOUNT_SERVICE:$TAG
- docker push $ACCOUNT_SERVICE
- export STATISTICS_SERVICE=amnonxx/piggymetrics-statistics-service
- docker build -t $STATISTICS_SERVICE:$COMMIT ./statistics-service
- docker tag $STATISTICS_SERVICE:$COMMIT $STATISTICS_SERVICE:$TAG
- docker push $STATISTICS_SERVICE
- export NOTIFICATION_SERVICE=amnonxx/piggymetrics-notification-service
- docker build -t $NOTIFICATION_SERVICE:$COMMIT ./notification-service
- docker tag $NOTIFICATION_SERVICE:$COMMIT $NOTIFICATION_SERVICE:$TAG
- docker push $NOTIFICATION_SERVICE
- export MONITORING=amnonxx/piggymetrics-monitoring
- docker build -t $MONITORING:$COMMIT ./monitoring
- docker tag $MONITORING:$COMMIT $MONITORING:$TAG
- docker push $MONITORING
- export TURBINE=amnonxx/piggymetrics-turbine-stream-service
- docker build -t $TURBINE:$COMMIT ./turbine-stream-service
- docker tag $TURBINE:$COMMIT $TURBINE:$TAG
- docker push $TURBINE
- export MONGO_DB=amnonxx/piggymetrics-mongodb
- docker build -t $MONGO_DB:$COMMIT ./mongodb
- docker tag $MONGO_DB:$COMMIT $MONGO_DB:$TAG
- docker push $MONGO_DB
